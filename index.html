<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portafolio 3D / AR - Angel Alejandro</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <script src="js/components.js"></script>
  <link rel="stylesheet" href="css/styles.css"> 
</head>
<body style="margin:0; overflow:hidden;">

  <div id="menu-container">
    <h1 class="menu-title">Elige tu Experiencia üöÄ</h1>
    <button class="menu-button" onclick="loadScene('desktop')">
      üíª Exploraci√≥n 3D (PC/Rat√≥n)
    </button>
    <button class="menu-button" onclick="loadScene('mobile')">
      üì± Exploraci√≥n 3D (Giroscopio/T√°ctil)
    </button>
    <button class="menu-button" onclick="loadScene('ar')">
      üñºÔ∏è Realidad Aumentada (AR)
    </button>
    <p class="menu-note">
      *AR y Giroscopio requieren un dispositivo m√≥vil.
    </p>
  </div>

  <div id="scene-container"></div>


  <script>
    function loadScene(mode) {
      const menu = document.getElementById('menu-container');
      
      // üö® CLAVE 1: Limpiar y recrear el contenedor de la escena para asegurar
      // que la instancia anterior de A-Frame (y AR.js si exist√≠a) se destruya por completo.
      let sceneContainer = document.getElementById('scene-container');
      if (sceneContainer) {
          sceneContainer.remove();
      }
      sceneContainer = document.createElement('div');
      sceneContainer.id = 'scene-container';
      document.body.appendChild(sceneContainer);

      // Ocultar el men√∫ con una transici√≥n suave
      menu.classList.add('hidden');
      setTimeout(() => { menu.style.display = 'none'; }, 1000); 

      // 2. Crear el elemento <a-scene>
      const scene = document.createElement('a-scene');
      
      // Atributos base (aplicables a todos los modos)
      scene.setAttribute('shadow', 'type: pcfsoft');
      scene.setAttribute('vr-mode-ui', 'enabled: true');
      
      let cameraContent = '';
      let sceneContent = '';

      // 3. L√≥gica de Modos (La correcci√≥n clave es aqu√≠)
      if (mode === 'ar') {
        // --- MODO AR (Realidad Aumentada) ---
        
        // S√ìLO a√±adimos arjs si es AR
        scene.setAttribute('arjs', 'trackingMethod: best; sourceType: webcam; debugUIEnabled: false;');
        scene.removeAttribute('embedded'); 
        
        // En AR, la escena 3D DEBE ir dentro de un <a-marker>
        sceneContent = `
            <a-marker preset="hiro">
                <a-entity gltf-model="url(assets/guitarra.glb)" position="0 0 0" rotation="0 30 0" scale="0.3 0.3 0.3" shadow="cast: true"
                          animation="property: rotation; to: 0 390 0; loop: true; dur: 15000; easing: linear;"></a-entity>
                          
                <a-entity position="0 1 0" rotation="0 0 0"
                          info-panel="title: üí° MODO AR; content: El modelo aparece sobre el marcador Hiro.; color: #ffd93d"></a-entity>
            </a-marker>
            
            <a-entity camera></a-entity>
        `;
        
      } else {
        // --- MODOS 3D NORMALES (Desktop y M√≥vil) ---
        
        // Aseguramos que NO tiene arjs, y S√ç tiene embedded
        scene.setAttribute('embedded', '');
        
        // Ajuste de robustez: Color de fondo s√≥lido de respaldo
        scene.setAttribute('background', 'color: #1e3c72');

        // 3. Configurar la C√°mara
        if (mode === 'desktop') {
          // PC: Movimiento WASD + Rat√≥n (look-controls)
          cameraContent = `
            <a-entity camera look-controls wasd-controls position="0 1.6 6">
              <a-cursor raycaster="objects: .clickable" color="#FFD93D" fuse="true" fuse-timeout="1500"></a-cursor>
            </a-entity>
          `;
        } else if (mode === 'mobile') {
          // M√≥vil: Giroscopio (look-controls) + Movimiento T√°ctil (touch-controls)
          cameraContent = `
            <a-entity camera look-controls touch-controls position="0 1.6 6">
              <a-cursor raycaster="objects: .clickable" color="#FFD93D" fuse="true" fuse-timeout="1500"></a-cursor>
            </a-entity>
          `;
        }
        
        // 4. Contenido de la escena 3D (Tu Cuarto Completo)
        sceneContent = `
            <a-light type="ambient" color="#FFF5E1" intensity="0.7"></a-light>
            <a-light type="point" position="0 2 -2" color="#FFD93D" intensity="1.2" distance="8" decay="2"></a-light>
            <a-light type="point" position="2 1 -1" color="#6EC1E4" intensity="0.8" distance="5" decay="2"></a-light>

            ${cameraContent}

            <a-plane position="0 0 0" rotation="-90 0 0" width="16" height="16" color="#2d2d40" shadow="receive: true"></a-plane>
            <a-box position="0 2 -8" depth="0.1" height="4" width="16" color="#3b3b5c"></a-box>
            <a-box position="-8 2 0" depth="16" height="4" width="0.1" color="#4a4a6a"></a-box>
            <a-box position="8 2 0" depth="16" height="4" width="0.1" color="#4a4a6a"></a-box>
            <a-box position="0 4 0" depth="16" height="0.1" width="16" color="#55557a"></a-box>

            <a-entity position="-5 1.7 -5" rotation="0 35 0"
                      info-panel="title: üìö Sobre m√≠; content: Soy un joven apasionado por la programaci√≥n, m√∫sica y creatividad.; color: #2a5298"
                      animation="property: position; to: -5 1.8 -5; dir: alternate; loop: true; dur: 2500; easing: easeInOutQuad;"></a-entity>

            <a-entity position="0 1.7 -4" rotation="0 0 0"
                      info-panel="title: üéØ Objetivos; content: ‚Ä¢ Convertirme en programador de alto nivel.\\n‚Ä¢ Construir portafolio s√≥lido.\\n‚Ä¢ Crear UBoxHouse; color: #1e3c72"
                      animation="property: position; to: 0 1.9 -4; dir: alternate; loop: true; dur: 2800; easing: easeInOutSine;"></a-entity>

            <a-entity position="5 1.7 -5" rotation="0 -35 0"
                      info-panel="title: üí° Intereses; content: ‚Ä¢ üéµ M√∫sica: producci√≥n y m√°ster\\n‚Ä¢ üíª Programaci√≥n: Java, Python, C++\\n‚Ä¢ üé¨ Edici√≥n: Photoshop, Premiere; color: #2c5364"
                      animation="property: position; to: 5 1.8 -5; dir: alternate; loop: true; dur: 2600; easing: easeInOutQuad;"></a-entity>

            <a-entity gltf-model="url(assets/guitarra.glb)" position="-4 0 -3" rotation="0 30 0" scale="0.3 0.3 0.3" shadow="cast: true"
                      animation="property: rotation; to: 0 390 0; loop: true; dur: 15000; easing: linear;"></a-entity>
            <a-entity gltf-model="url(assets/laptop.glb)" position="4 0 -3" rotation="0 -20 0" scale="0.4 0.4 0.4" shadow="cast: true"
                      animation="property: rotation; to: 0 340 0; loop: true; dur: 14000; easing: linear;"></a-entity>

            <a-text value="¬© 2025 - Creado por Angel Alejandro üöÄ"
                    position="0 0.2 -2.5"
                    align="center"
                    color="#AAA"
                    width="6"></a-text>
        `;
      }

      // 5. Inyectar el contenido y montar la escena
      scene.innerHTML = sceneContent;
      sceneContainer.appendChild(scene);

      // üö® CLAVE 2: Forzar la reproducci√≥n de la escena (siempre necesario para estabilidad)
      if (scene.hasLoaded) {
          scene.play();
      } else {
          scene.addEventListener('loaded', function () {
              scene.play();
          });
      }
    }
  </script>

</body>
</html>

