<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portafolio 3D / AR - Angel Alejandro</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  
  <script src="js/components.js"></script>
  <link rel="stylesheet" href="css/styles.css"> 
</head>
<body style="margin:0; overflow:hidden;">

  <div id="menu-container">
    <h1 class="menu-title">Elige tu Experiencia üöÄ</h1>
    <button class="menu-button" onclick="loadScene('desktop')">
      üíª Exploraci√≥n 3D (PC/Rat√≥n)
    </button>
    <button class="menu-button" onclick="loadScene('mobile')">
      üì± Exploraci√≥n 3D (Giroscopio/T√°ctil)
    </button>
    <button class="menu-button" onclick="enterImmersiveMode()">
      üï∂Ô∏è Realidad Aumentada (Pok√©mon GO)
    </button>
    <p class="menu-note">
      *El modo AR requiere Chrome/Safari actualizados y permisos de c√°mara.
    </p>
  </div>

  <div id="scene-container"></div>


  <script>
    // Referencia global para la escena (esencial para la limpieza)
    let currentScene = null; 

    function loadScene(mode) {
      const menu = document.getElementById('menu-container');
      const sceneContainer = document.getElementById('scene-container');
      
      // 1. Limpieza de escena anterior (FUNDAMENTAL para la estabilidad m√≥vil)
      if (currentScene) {
          currentScene.remove();
          currentScene = null;
      }
      sceneContainer.innerHTML = '';
      
      // Ocultar el men√∫
      menu.classList.add('hidden');
      setTimeout(() => { menu.style.display = 'none'; }, 1000); 

      // 2. Crear el elemento <a-scene>
      const scene = document.createElement('a-scene');
      currentScene = scene; // Guardar la referencia

      // Atributos base 
      // Si es AR, 'embedded' es 'false' (pantalla completa para la c√°mara).
      scene.setAttribute('embedded', mode === 'ar' ? 'false' : 'true'); 
      scene.setAttribute('shadow', 'type: pcfsoft');
      scene.setAttribute('vr-mode-ui', 'enabled: true'); 
      scene.setAttribute('background', 'color: #1e3c72'); 

      let cameraControls = '';
      let sceneContent = ''; 

      // 3. Configurar la C√°mara y Controles
      if (mode === 'desktop') {
        cameraControls = 'look-controls wasd-controls';
      } else if (mode === 'mobile' || mode === 'ar') { 
        cameraControls = 'look-controls touch-controls';
      }
      
      const cameraContent = `
        <a-entity camera ${cameraControls} position="0 1.6 6">
          <a-cursor raycaster="objects: .clickable" color="#FFD93D" fuse="true" fuse-timeout="1500"></a-cursor>
        </a-entity>
      `;
      
      // 4. Contenido de la escena 
      
      // Estructura de los paneles con separaci√≥n corregida (-2, 0, 2)
      const panelContent = `
        <a-entity position="-2 1.7 0" rotation="0 35 0"
                  info-panel="title: üìö Sobre mi; content: Soy un joven apasionado por la programaci√≥n, m√∫sica y creatividad.; color: #2a5298"
                  animation="property: position; to: -2 1.8 0; dir: alternate; loop: true; dur: 2500; easing: easeInOutQuad;"></a-entity>

        <a-entity position="0 1.7 0" rotation="0 0 0"
                  info-panel="title: üéØ Objetivos; content: ‚Ä¢ Convertirme en programador de alto nivel.\\n‚Ä¢ Construir portafolio solido.\\n‚Ä¢ Crear UBoxHouse; color: #1e3c72"
                  animation="property: position; to: 0 1.9 0; dir: alternate; loop: true; dur: 2800; easing: easeInOutSine;"></a-entity>

        <a-entity position="2 1.7 0" rotation="0 -35 0"
                  info-panel="title: üí° Intereses; content: ‚Ä¢ üéµ Musica: producci√≥n y m√°ster\\n‚Ä¢ üíª Programacion: Java, Python, C++\\n‚Ä¢ üé¨ Edici√≥n: Photoshop, Premiere; color: #2c5364"
                  animation="property: position; to: 2 1.8 0; dir: alternate; loop: true; dur: 2600; easing: easeInOutQuad;"></a-entity>
      `;

      if (mode === 'ar') {
        // --- MODO AR: Detecci√≥n de Plano (Solo Paneles en WebXR) ---
        
        sceneContent = `
            ${cameraContent}
            
            <a-light type="ambient" color="#FFF5E1" intensity="0.7"></a-light>
            
            <a-entity webxr-ar-anchor="target: floor;">
                ${panelContent.replace(/position="(-?\d+)\s+1.7\s+(-?\d+)"/g, (match, x, z) => `position="${x} 0.5 ${z}"`)}
                
                <a-text value="Mueve el celular para detectar una superficie"
                    position="0 0.1 0"
                    align="center"
                    color="#FFD93D"
                    width="2.5"></a-text>
            </a-entity>
        `;
        
      } else {
        // --- MODOS 3D NORMALES (Desktop y M√≥vil) ---
        
        // Contenido completo del cuarto
        sceneContent = `
            <a-light type="ambient" color="#FFF5E1" intensity="0.7"></a-light>
            <a-light type="point" position="0 2 -2" color="#FFD93D" intensity="1.2" distance="8" decay="2"></a-light>
            <a-light type="point" position="2 1 -1" color="#6EC1E4" intensity="0.8" distance="5" decay="2"></a-light>

            ${cameraContent}

            <a-plane position="0 0 0" rotation="-90 0 0" width="16" height="16" color="#2d2d40" shadow="receive: true"></a-plane>
            <a-box position="0 2 -8" depth="0.1" height="4" width="16" color="#3b3b5c"></a-box>
            <a-box position="-8 2 0" depth="16" height="4" width="0.1" color="#4a4a6a"></a-box>
            <a-box position="8 2 0" depth="16" height="4" width="0.1" color="#4a4a6a"></a-box>
            <a-box position="0 4 0" depth="16" height="0.1" width="16" color="#55557a"></a-box>

            ${panelContent}
            
            <a-entity gltf-model="url(assets/guitarra.glb)" position="-4 0 -3" rotation="0 30 0" scale="0.1 0.1 0.1" shadow="cast: true"
                      animation="property: rotation; to: 0 390 0; loop: true; dur: 15000; easing: linear;"></a-entity>
            <a-entity gltf-model="url(assets/laptop.glb)" position="4 0 -3" rotation="0 -20 0" scale="0.4 0.4 0.4" shadow="cast: true"
                      animation="property: rotation; to: 0 340 0; loop: true; dur: 14000; easing: linear;"></a-entity>

            <a-text value="¬© 2025 - Creado por Angel Alejandro üöÄ"
                    position="0 0.2 -2.5"
                    align="center"
                    color="#AAA"
                    width="6"></a-text>
        `;
      }

      // 5. Inyectar y reproducir la escena
      scene.innerHTML = sceneContent;
      sceneContainer.appendChild(scene);

      // Forzar la reproducci√≥n
      scene.addEventListener('loaded', function () {
          scene.play();
      });
    }

    // Funci√≥n que llama el bot√≥n de WebXR y activa la c√°mara
    function enterImmersiveMode() {
        // 1. Cargamos la escena en modo 'ar' (solo paneles)
        loadScene('ar');

        // 2. üö® CLAVE: Esperamos un momento para asegurar que la escena est√© lista
        setTimeout(() => {
            if (currentScene && currentScene.is('loaded')) {
                // Forzamos el modo AR. Esto abre la c√°mara y activa la detecci√≥n de plano.
                currentScene.enterAR(); 
            } else {
                console.error('La escena no est√° lista para AR.');
            }
        }, 1000); // Esperamos 1 segundo
    }
</script>

</body>
</html>
